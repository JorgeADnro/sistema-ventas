import{a as $t}from"./chunk-2PX2V5L3.js";import{a as C}from"./chunk-SNZVP43R.js";import{A as dt,B as ft,F as ht,G as gt,H as _t,I as Ct,J as vt,K as bt,L as wt,M as Et,N as St,O as xt,P as yt,Q as Dt,R as j,S as It,T as Ut,U as Mt,V as Ft,W as Tt,X as Ot,Y as Rt,Z as Nt,a as tt,b as k,e as et,f as it,k as rt,l as f,m as ot,n as at,o as nt,p as st,q as mt,r as lt,s as ut,x as pt,y as ct}from"./chunk-JJW7TMR6.js";import{a as $,l as B}from"./chunk-UDCYXUZB.js";import"./chunk-IX6G3U3V.js";import{Cb as o,Db as a,E as b,Eb as c,Fb as w,Gb as E,Ib as Q,Kc as R,Lb as v,Lc as N,Nb as S,Nc as Z,Rb as J,Sb as K,Tb as X,Vb as s,W as _,Wb as x,Xb as h,Za as m,_a as d,_b as Y,aa as M,ba as F,c as W,fa as D,j as U,ka as T,la as O,q as G,rb as p,ta as L,tb as u,ua as q}from"./chunk-WSLSRKTI.js";var P=(()=>{let e=class e{constructor(i,r){this.snackBar=i,this.http=r}listarUsuarios(){return this.http.get(`${C.API_URL}/users/usuarios`,{headers:{requireToken:"true"}}).pipe(b(i=>this.handlerError(i)))}listarRoles(){return this.http.get(`${C.API_URL}/roles/roles`,{headers:{requireToken:"true"}}).pipe(b(i=>this.handlerError(i)))}insertarUsuario(i){return this.http.post(`${C.API_URL}/users/usuarios`,i,{headers:{requireToken:"true"}}).pipe(b(r=>this.handlerError(r)))}actualizarUsuario(i,r){return this.http.put(`${C.API_URL}/users/usuarios/${i}`,r,{headers:{requireToken:"true"}}).pipe(b(n=>this.handlerError(n)))}eliminarUsuario(i){return this.http.delete(`${C.API_URL}/users/usuarios/${i}`,{headers:{requireToken:"true"}}).pipe(b(r=>this.handlerError(r)))}handlerError(i){console.log(i);var r="Ocurri\xF3 un error";return i.error&&(i.error.message?r=i.error.message:r="Ocurri\xF3 un error"),this.snackBar.open(r,"",{duration:3e3}),G(()=>new Error(r))}};e.\u0275fac=function(r){return new(r||e)(D(et),D($))},e.\u0275prov=M({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var jt=(()=>{let e=class e{constructor(i){this.http=i}getRoles(){return this.http.get(`${C.API_URL}/roles/roles`)}};e.\u0275fac=function(r){return new(r||e)(D($))},e.\u0275prov=M({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function Gt(t,e){if(t&1&&(o(0,"mat-option",15),s(1),a()),t&2){let l=e.$implicit;u("value",l.id),m(),x(l.nombre)}}function Qt(t,e){if(t&1&&(o(0,"mat-form-field",2)(1,"mat-label"),s(2,"Contrase\xF1a"),a(),c(3,"input",16),o(4,"mat-error"),s(5),a()()),t&2){let l=S();m(5),h(" ",l.baseForm.getErrorMessage(l.userForm.get("password"))," ")}}function Jt(t,e){if(t&1&&(o(0,"mat-form-field",2)(1,"mat-label"),s(2,"Repetir Contrase\xF1a"),a(),c(3,"input",17),o(4,"mat-error"),s(5),a()()),t&2){let l=S();m(5),h(" ",l.baseForm.getErrorMessage(l.userForm.get("confirmPassword"))," ")}}var y=function(t){return t.EDIT="edit",t.NEW="new",t}(y||{}),Pt=(()=>{let e=class e{constructor(i,r,n,g,H,V){this.data=i,this.dialogRef=r,this.fb=n,this.baseForm=g,this.usuarioSvc=H,this.rolesService=V,this.destroy$=new U,this.titleButton="Guardar",this.actionTODO=y.NEW,this.roles=[],this.userForm=this.fb.group({cveUsuario:[""],nombre:["",[f.required,f.minLength(3)]],apellidos:["",[f.required,f.minLength(3)]],username:["",[f.required,f.minLength(3)]],rol:[[],[f.required]],password:["",[f.required]],confirmPassword:["",[f.required]]},{validator:this.passwordMatchValidator})}ngOnInit(){this.usuarioSvc.listarRoles().pipe(_(this.destroy$)).subscribe(i=>{this.roles=i,this.pathData()})}pathData(){this.data.user.cveUsuario?(this.userForm.patchValue({cveUsuario:this.data?.user.cveUsuario,nombre:this.data?.user.nombre,apellidos:this.data?.user.apellidos,username:this.data?.user.username,rol:this.data.user.roles.map(i=>i.id)}),this.userForm.get("username")?.disable(),this.userForm.get("password")?.setValidators(null),this.userForm.get("password")?.setErrors(null),this.userForm.get("confirmPassword")?.setValidators(null),this.userForm.get("confirmPassword")?.setErrors(null),this.userForm.updateValueAndValidity(),this.titleButton="Actualizar",this.actionTODO=y.EDIT):(this.titleButton="Guardar",this.actionTODO=y.NEW)}onSave(){if(!this.userForm.invalid){var i=this.userForm.getRawValue();if(this.actionTODO==y.NEW){var r={nombre:i.nombre,apellidos:i.apellidos,username:i.username,password:i.password,rol:i.rol};this.usuarioSvc.insertarUsuario(r).pipe(_(this.destroy$)).subscribe(A=>{this.dialogRef.close(A)})}else{var z=i,{confirmPassword:n,password:g,username:H}=z,V=W(z,["confirmPassword","password","username"]);let A=this.data.user.cveUsuario;this.usuarioSvc.actualizarUsuario(A,V).pipe(_(this.destroy$)).subscribe(Lt=>{this.dialogRef.close(Lt)})}}}onClear(){this.actionTODO===y.NEW?this.userForm.reset():this.userForm.patchValue({nombre:"",apellidos:"",rol:""})}checkPasswords(i){let r=i.get("password")?.value,n=i.get("confirmPassword")?.value;return r===n?null:{notSame:!0}}passwordMatchValidator(i){let r=i.get("password")?.value,n=i.get("confirmPassword")?.value;r!==n?i.get("confirmPassword")?.setErrors({mismatch:!0}):i.get("confirmPassword")?.setErrors(null)}ngOnDestroy(){this.destroy$.next({}),this.destroy$.complete()}};e.\u0275fac=function(r){return new(r||e)(d(Ut),d(It),d(lt),d($t),d(P),d(jt))},e.\u0275cmp=T({type:e,selectors:[["app-usuario-dialog"]],decls:37,vars:8,consts:[["mat-dialog-title",""],[3,"submit","formGroup"],["appearance","outline",1,"full-width"],["type","text","formControlName","nombre","matInput",""],["type","text","formControlName","apellidos","matInput",""],["type","text","formControlName","username","matInput",""],["apparence","outline",1,"full-width"],["formControlName","rol","multiple",""],[3,"value",4,"ngFor","ngForOf"],["class","full-width","appearance","outline",4,"ngIf"],["align","center"],["type","button","mat-flat-button","","color","warn",1,"me-2",3,"click"],["type","submit","mat-flat-button","","color","primary"],["align","end"],["mat-button","","mat-dialog-close",""],[3,"value"],["type","password","formControlName","password","matInput",""],["type","password","formControlName","confirmPassword","matInput",""]],template:function(r,n){r&1&&(o(0,"h1",0),s(1,"Usuario"),a(),o(2,"mat-dialog-content")(3,"form",1),v("submit",function(){return n.onSave()}),o(4,"mat-form-field",2)(5,"mat-label"),s(6,"Nombre"),a(),c(7,"input",3),o(8,"mat-error"),s(9),a()(),o(10,"mat-form-field",2)(11,"mat-label"),s(12,"Apellidos"),a(),c(13,"input",4),o(14,"mat-error"),s(15),a()(),o(16,"mat-form-field",2)(17,"mat-label"),s(18,"Nombre de Usuario"),a(),c(19,"input",5),o(20,"mat-error"),s(21),a()(),o(22,"mat-form-field",6)(23,"mat-label"),s(24,"Rol(es)"),a(),o(25,"mat-select",7),p(26,Gt,2,2,"mat-option",8),a()(),p(27,Qt,6,1,"mat-form-field",9)(28,Jt,6,1,"mat-form-field",9),o(29,"div",10)(30,"button",11),v("click",function(){return n.onClear()}),s(31," Limpiar "),a(),o(32,"button",12),s(33),a()()()(),o(34,"mat-dialog-actions",13)(35,"button",14),s(36," Cerrar "),a()()),r&2&&(m(3),u("formGroup",n.userForm),m(6),h(" ",n.baseForm.getErrorMessage(n.userForm.get("nombre"))," "),m(6),h(" ",n.baseForm.getErrorMessage(n.userForm.get("apellidos"))," "),m(6),h(" ",n.baseForm.getErrorMessage(n.userForm.get("username"))," "),m(5),u("ngForOf",n.roles),m(),u("ngIf",n.actionTODO=="new"),m(),u("ngIf",n.actionTODO=="new"),m(5),h(" ",n.titleButton," "))},dependencies:[R,N,nt,rt,ot,at,st,mt,k,ft,dt,pt,ct,Ft,Tt,Rt,Ot,Dt,tt]});let t=e;return t})();var Kt=()=>[5,10,20,100];function Xt(t,e){t&1&&(o(0,"th",16),s(1," Nombre "),a())}function Yt(t,e){if(t&1&&(o(0,"td",17),s(1),a()),t&2){let l=e.$implicit;m(),x(l.nombre)}}function Zt(t,e){t&1&&(o(0,"th",16),s(1," Apellidos "),a())}function te(t,e){if(t&1&&(o(0,"td",17),s(1),a()),t&2){let l=e.$implicit;m(),x(l.apellidos)}}function ee(t,e){t&1&&(o(0,"th",16),s(1," Nombre de Usuario "),a())}function ie(t,e){if(t&1&&(o(0,"td",17),s(1),a()),t&2){let l=e.$implicit;m(),x(l.username)}}function re(t,e){t&1&&(o(0,"th",16),s(1," Rol(es) "),a())}function oe(t,e){t&1&&(o(0,"span"),s(1,", "),a())}function ae(t,e){if(t&1&&(o(0,"span"),s(1),p(2,oe,2,0,"span",19),a()),t&2){let l=e.$implicit,i=e.last;m(),h(" ",l.nombre,""),m(),u("ngIf",!i)}}function ne(t,e){if(t&1&&(o(0,"td",17),p(1,ae,3,2,"span",18),a()),t&2){let l=e.$implicit;m(),u("ngForOf",l.roles)}}function se(t,e){t&1&&c(0,"th",16)}function me(t,e){if(t&1){let l=Q();o(0,"td",20)(1,"button",21),v("click",function(){let r=L(l).$implicit,n=S();return q(n.onOpenModal(r))}),o(2,"mat-icon"),s(3,"edit"),a(),s(4," Editar "),a(),o(5,"button",22),v("click",function(){let r=L(l).$implicit,n=S();return q(n.onDelete(r.cveUsuario))}),o(6,"mat-icon"),s(7,"delete"),a(),s(8," Eliminar "),a()()}}function le(t,e){t&1&&c(0,"tr",23)}function ue(t,e){t&1&&c(0,"tr",24)}var Vt=(()=>{let e=class e{constructor(i,r){this.dialog=i,this.usuarioSvc=r,this.destroy$=new U,this.dataSource=new yt,this.displayedColumns=["nombre","apellidos","username","rol","acciones"]}ngOnInit(){this.listar()}listar(){this.usuarioSvc.listarUsuarios().pipe(_(this.destroy$)).subscribe(i=>{this.dataSource.data=i})}ngAfterViewInit(){this.dataSource.paginator=this.paginator}onOpenModal(i={}){this.dialog.open(Pt,{maxWidth:"100%",width:"80%",data:{user:i}}).afterClosed().pipe(_(this.destroy$)).subscribe(n=>{n&&this.listar()})}onDelete(i){this.usuarioSvc.eliminarUsuario(i).pipe(_(this.destroy$)).subscribe(r=>{this.listar()})}ngOnDestroy(){this.destroy$.next({}),this.destroy$.complete()}};e.\u0275fac=function(r){return new(r||e)(d(Mt),d(P))},e.\u0275cmp=T({type:e,selectors:[["app-usuarios"]],viewQuery:function(r,n){if(r&1&&J(j,5),r&2){let g;K(g=X())&&(n.paginator=g.first)}},decls:27,vars:5,consts:[[1,"m-3"],["align","right"],["mat-flat-button","","color","primary",1,"m-2",3,"click"],[1,"table-content","mat-elevation-z8","m-4"],["mat-table","",3,"dataSource"],["matColumnDef","nombre"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","apellidos"],["matColumnDef","username"],["matColumnDef","rol"],["matColumnDef","acciones"],["mat-cell","","class","text-center",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],[4,"ngFor","ngForOf"],[4,"ngIf"],["mat-cell","",1,"text-center"],["mat-flat-button","","color","accent",1,"me-2",3,"click"],["mat-flat-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(r,n){r&1&&(o(0,"h3",0),s(1,"Usuarios"),a(),o(2,"div",1)(3,"button",2),v("click",function(){return n.onOpenModal()}),o(4,"mat-icon"),s(5,"add"),a(),s(6," Agregar "),a()(),o(7,"div",3)(8,"table",4),w(9,5),p(10,Xt,2,0,"th",6)(11,Yt,2,1,"td",7),E(),w(12,8),p(13,Zt,2,0,"th",6)(14,te,2,1,"td",7),E(),w(15,9),p(16,ee,2,0,"th",6)(17,ie,2,1,"td",7),E(),w(18,10),p(19,re,2,0,"th",6)(20,ne,2,1,"td",7),E(),w(21,11),p(22,se,1,0,"th",6)(23,me,9,0,"td",12),E(),p(24,le,1,0,"tr",13)(25,ue,1,0,"tr",14),a(),c(26,"mat-paginator",15),a()),r&2&&(m(8),u("dataSource",n.dataSource),m(16),u("matHeaderRowDef",n.displayedColumns),m(),u("matRowDefColumns",n.displayedColumns),m(),u("pageSizeOptions",Y(4,Kt)))},dependencies:[R,N,k,it,ht,_t,wt,Ct,gt,Et,vt,bt,St,xt,j]});let t=e;return t})();var pe=[{path:"",component:Vt}],At=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=O({type:e}),e.\u0275inj=F({imports:[B.forChild(pe),B]});let t=e;return t})();var We=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=O({type:e}),e.\u0275inj=F({imports:[Z,At,ut,Nt]});let t=e;return t})();export{We as UsuariosModule};
